<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Ù…Ø© - Ø§Ù„Ø³ÙŠÙ Ø§Ù„Ù…Ø®ÙÙ ğŸ—¡ï¸</title>
    <style>
        /* ğŸ”¥ Ù†Ø¸Ø§Ù… ØªØµÙ…ÙŠÙ… Ø£Ø¨Ø³Ø· */
        :root {
            --bg: #0a0a0a;
            --layer1: #1a1a1a;
            --layer2: #2a2a2a;
            --text: #e0e0e0;
            --text-dim: #888;
            --accent: #444;
            --danger: #5a1a1a;
            --success: #1a5a1a;
            --toast-bg: rgba(0, 0, 0, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* ğŸ”¥ Ø­Ø§ÙˆÙŠØ§Øª Ø£Ù‚Ù„ØŒ Ø£Ù†Ø¸Ù */
        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ğŸ”¥ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø®ÙÙ */
        .header {
            background: var(--layer1);
            padding: 8px 12px;
            border-bottom: 1px solid var(--layer2);
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .deep-mode-btn {
            background: var(--layer2);
            border: 1px solid var(--accent);
            color: var(--text-dim);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
        }

        /* ğŸ”¥ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ÙÙØ© */
        .text-area {
            flex: 1;
            padding: 12px;
            overflow: auto;
        }

        #textInput {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 18px;
            line-height: 1.5;
            font-family: 'Courier New', monospace;
            resize: none;
            outline: none;
            overflow-wrap: break-word;
            caret-color: var(--text);
        }

        /* ğŸ”¥ Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹ - Ø§Ù„Ø£Ù‡Ù… */
        .quick-bar {
            background: var(--layer1);
            border-top: 1px solid var(--layer2);
            padding: 6px;
            display: flex;
            gap: 4px;
            overflow-x: auto;
            flex-shrink: 0;
            min-height: 48px;
        }

        .quick-btn {
            background: var(--layer2);
            border: 1px solid var(--accent);
            color: var(--text);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .quick-btn:active {
            background: var(--accent);
        }

        /* ğŸ”¥ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø®ÙÙØ© */
        .keyboard {
            background: var(--layer1);
            border-top: 1px solid var(--layer2);
            padding: 8px;
            display: grid;
            grid-template-rows: repeat(4, 1fr);
            gap: 4px;
            flex-shrink: 0;
        }

        .keyboard-row {
            display: flex;
            gap: 4px;
        }

        .key {
            background: var(--layer2);
            border: 1px solid var(--accent);
            color: var(--text);
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            min-height: 48px;
            touch-action: manipulation;
        }

        .key:active {
            background: var(--accent);
        }

        .key.space {
            flex: 3;
        }

        .key.delete {
            background: var(--danger);
        }

        .key.enter {
            background: var(--success);
        }

        /* ğŸ”¥ Ø§Ù„ØªÙˆØ³Øª (Ø¨Ø¯Ù„ alert) */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--toast-bg);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
        }

        /* ğŸ”¥ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø§Ù„Ù…Ø®ÙÙØ© (ØªØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© ÙÙ‚Ø·) */
        .clipboard-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            padding: 20px;
            overflow: hidden;
        }

        .clipboard-overlay.show {
            display: flex;
            flex-direction: column;
        }

        .clipboard-header {
            padding: 12px;
            background: var(--layer1);
            border-bottom: 1px solid var(--layer2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .clipboard-search {
            width: 100%;
            padding: 8px;
            background: var(--layer2);
            border: 1px solid var(--accent);
            color: var(--text);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .clipboard-items {
            flex: 1;
            overflow-y: auto;
        }

        .clipboard-item {
            padding: 10px;
            border-bottom: 1px solid var(--layer2);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .clipboard-item:hover {
            background: var(--layer2);
        }

        /* ğŸ”¥ ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø© */
        body.deep-writing .header,
        body.deep-writing .quick-bar {
            display: none;
        }

        body.deep-writing .text-area {
            padding: 0;
        }

        body.deep-writing #textInput {
            font-size: 20px;
            padding: 20px;
        }

        /* ğŸ”¥ Ø§Ù„Ù„Ù Ø§Ù„Ø³Ù„Ø³ */
        .scroll-smooth {
            scroll-behavior: smooth;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ğŸ”¥ Ù‡ÙŠØ¯Ø± Ù…Ø®ÙÙ -->
        <div class="header">
            <div class="header-title">
                <span>ğŸ—¡ï¸</span>
                <span>ÙØ­Ù…Ø©</span>
            </div>
            <button class="deep-mode-btn" id="deepModeBtn">ğŸ•³ï¸ Ø¹Ù…ÙŠÙ‚</button>
        </div>

        <!-- ğŸ”¥ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù†Øµ -->
        <div class="text-area scroll-smooth">
            <textarea id="textInput" placeholder="Ø§ÙƒØªØ¨... (Ø§Ø®ØªØµØ§Ø±Ø§Øª: gm, fn, cl, im)"></textarea>
        </div>

        <!-- ğŸ”¥ Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹ - Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <div class="quick-bar" id="quickBar">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
        </div>

        <!-- ğŸ”¥ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ -->
        <div class="keyboard" id="keyboard">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
        </div>
    </div>

    <!-- ğŸ”¥ Ø§Ù„ØªÙˆØ³Øª -->
    <div class="toast" id="toast"></div>

    <!-- ğŸ”¥ Ø§Ù„Ø­Ø§ÙØ¸Ø© (Ù…Ø®ÙÙŠØ© Ø­ØªÙ‰ ØªÙØªØ­) -->
    <div class="clipboard-overlay" id="clipboardOverlay">
        <div class="clipboard-header">
            <span>ğŸ“‹ Ø§Ù„Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø°ÙƒÙŠØ©</span>
            <button class="quick-btn" id="closeClipboardBtn">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <input type="text" class="clipboard-search" id="clipboardSearch" placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø­Ø§ÙØ¸Ø©...">
        <div class="clipboard-items scroll-smooth" id="clipboardItems">
            <!-- Ø³ØªØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ ÙÙ‚Ø· -->
        </div>
    </div>

    <script>
        // ğŸ”¥ Ø­Ø§Ù„Ø© Ù…Ø®ÙÙØ© - Ø£Ù‚Ù„ ØªØ¹Ù‚ÙŠØ¯Ø§Ù‹
        const state = {
            text: '',
            shortcuts: {
                'gm': 'console.log();',
                'fn': 'function() {}',
                'cl': 'class {}',
                'im': 'import from \'\';',
                'ph': '+9665XXXXXXXX',
                'em': 'email@example.com',
                'sg': '---\nÙØ­Ù…Ø© ğŸ—¡ï¸'
            },
            quickShortcuts: ['gm', 'fn', 'cl', 'im', 'ph', 'em', 'sg'],
            clipboard: [],
            lastWord: '',
            isDeepMode: false,
            saveTimer: null,
            clipboardData: [] // Ù…Ø®Ø²Ù† Ù…Ø¤Ù‚Øª Ù„Ù„Ø­Ø§ÙØ¸Ø©
        };

        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø£Ø®Ù)
        document.addEventListener('DOMContentLoaded', () => {
            initQuickBar();
            initKeyboard();
            initEvents();
            loadInitialState();
            document.getElementById('textInput').focus();
        });

        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹
        function initQuickBar() {
            const quickBar = document.getElementById('quickBar');
            quickBar.innerHTML = '';
            
            // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const commands = [
                { text: 'ğŸ“‹', action: 'openClipboard' },
                { text: '<>', action: 'brackets' },
                { text: '{}', action: 'curly' },
                { text: '()', action: 'parentheses' },
                { text: 'â†’', action: 'arrow' },
                { text: '/', action: 'slash' },
                { text: 'Ù†Ø³Ø®', action: 'copy' },
                { text: 'Ù„ØµÙ‚', action: 'paste' }
            ];
            
            commands.forEach(cmd => {
                const btn = document.createElement('button');
                btn.className = 'quick-btn';
                btn.textContent = cmd.text;
                btn.dataset.action = cmd.action;
                quickBar.appendChild(btn);
            });
            
            // Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©
            state.quickShortcuts.forEach(shortcut => {
                const btn = document.createElement('button');
                btn.className = 'quick-btn';
                btn.textContent = shortcut;
                btn.dataset.shortcut = shortcut;
                quickBar.appendChild(btn);
            });
        }

        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        function initKeyboard() {
            const keyboard = document.getElementById('keyboard');
            const rows = [
                ['Ø¶', 'Øµ', 'Ø«', 'Ù‚', 'Ù', 'Øº', 'Ø¹', 'Ù‡', 'Ø®', 'Ø­', 'Ø¬', 'Ø¯', 'Ø°'],
                ['Ø´', 'Ø³', 'ÙŠ', 'Ø¨', 'Ù„', 'Ø§', 'Øª', 'Ù†', 'Ù…', 'Ùƒ', 'Ø·', 'â†'],
                ['Ø¦', 'Ø¡', 'Ø¤', 'Ø±', 'Ù„Ø§', 'Ù‰', 'Ø©', 'Ùˆ', 'Ø²', 'Ø¸', 'âŒ«'],
                ['#+=', 'ØŒ', 'Ù…Ø³Ø§ÙØ©', 'â†µ']
            ];

            keyboard.innerHTML = '';
            
            rows.forEach(rowKeys => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                
                rowKeys.forEach(key => {
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    
                    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø®Ø§ØµØ©
                    if (key === 'âŒ«') {
                        keyDiv.classList.add('delete');
                        keyDiv.textContent = 'âŒ«';
                    } else if (key === 'â†µ') {
                        keyDiv.classList.add('enter');
                        keyDiv.textContent = 'â†µ';
                    } else if (key === 'Ù…Ø³Ø§ÙØ©') {
                        keyDiv.classList.add('space');
                        keyDiv.textContent = '____';
                    } else {
                        keyDiv.textContent = key;
                    }
                    
                    rowDiv.appendChild(keyDiv);
                });
                
                keyboard.appendChild(rowDiv);
            });
        }

        // ğŸ”¥ ØªÙ‡ÙŠØ¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Event Delegation)
        function initEvents() {
            const app = document.getElementById('app');
            
            // ğŸ”¥ Ø­Ø¯Ø« ÙˆØ§Ø­Ø¯ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            app.addEventListener('click', (e) => {
                const target = e.target;
                
                // Ù…ÙØ§ØªÙŠØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
                if (target.classList.contains('key')) {
                    e.preventDefault();
                    const key = target.textContent;
                    handleKeyPress(key);
                    return;
                }
                
                // Ø£Ø²Ø±Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª
                if (target.classList.contains('quick-btn')) {
                    e.preventDefault();
                    
                    if (target.dataset.action) {
                        handleCommand(target.dataset.action);
                    } else if (target.dataset.shortcut) {
                        insertShortcut(target.dataset.shortcut);
                    }
                    return;
                }
            });
            
            // ğŸ”¥ Ø£Ø­Ø¯Ø§Ø« Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©
            document.getElementById('deepModeBtn').addEventListener('click', toggleDeepMode);
            document.getElementById('closeClipboardBtn').addEventListener('click', closeClipboard);
            document.getElementById('clipboardSearch').addEventListener('input', searchClipboard);
            
            // ğŸ”¥ Ø­Ø¯Ø« Ø§Ù„Ù†Øµ Ù…Ø¹ Debounce
            const textInput = document.getElementById('textInput');
            textInput.addEventListener('input', (e) => {
                state.text = e.target.value;
                updateLastWord();
                autoSave();
                checkForShortcuts();
            });
            
            // ğŸ”¥ Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
            textInput.addEventListener('copy', () => {
                const selected = window.getSelection().toString();
                if (selected.trim()) {
                    addToClipboard(selected);
                }
            });
            
            // ğŸ”¥ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', (e) => {
                // Ctrl+B Ù„ÙØªØ­ Ø§Ù„Ø­Ø§ÙØ¸Ø©
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    openClipboard();
                }
                
                // Esc Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§ÙØ¸Ø©
                if (e.key === 'Escape') {
                    closeClipboard();
                }
            });
        }

        // ğŸ”¥ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¶ØºØ·Ø© Ø§Ù„Ù…ÙØªØ§Ø­
        function handleKeyPress(key) {
            const textInput = document.getElementById('textInput');
            const cursorPos = textInput.selectionStart;
            const text = textInput.value;
            
            switch(key) {
                case 'âŒ«':
                    if (cursorPos > 0) {
                        textInput.value = text.slice(0, cursorPos - 1) + text.slice(cursorPos);
                        textInput.selectionStart = cursorPos - 1;
                        textInput.selectionEnd = cursorPos - 1;
                    }
                    break;
                    
                case 'â†µ':
                    insertAtCursor('\n');
                    break;
                    
                case 'Ù…Ø³Ø§ÙØ©':
                    insertAtCursor(' ');
                    break;
                    
                case 'â†':
                    textInput.selectionStart = Math.max(0, cursorPos - 1);
                    textInput.selectionEnd = Math.max(0, cursorPos - 1);
                    break;
                    
                case '#+=':
                    showToast('Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ù…ÙˆØ² - Ù‚Ø±ÙŠØ¨Ù‹Ø§');
                    break;
                    
                case 'ØŒ':
                    insertAtCursor('ØŒ');
                    break;
                    
                default:
                    insertAtCursor(key);
            }
            
            textInput.focus();
        }

        // ğŸ”¥ Ø¥Ø¯Ø±Ø§Ø¬ Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø¤Ø´Ø±
        function insertAtCursor(textToInsert) {
            const textInput = document.getElementById('textInput');
            const cursorPos = textInput.selectionStart;
            const text = textInput.value;
            
            textInput.value = text.slice(0, cursorPos) + textToInsert + text.slice(cursorPos);
            textInput.selectionStart = cursorPos + textToInsert.length;
            textInput.selectionEnd = cursorPos + textToInsert.length;
        }

        // ğŸ”¥ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø±
        function handleCommand(cmd) {
            switch(cmd) {
                case 'openClipboard':
                    openClipboard();
                    break;
                case 'copy':
                    navigator.clipboard.writeText(state.text)
                        .then(() => showToast('ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
                    break;
                case 'paste':
                    navigator.clipboard.readText()
                        .then(text => {
                            insertAtCursor(text);
                            showToast('ØªÙ… Ø§Ù„Ù„ØµÙ‚');
                        });
                    break;
                case 'brackets':
                    insertAround('<', '>');
                    break;
                case 'curly':
                    insertAround('{', '}');
                    break;
                case 'parentheses':
                    insertAround('(', ')');
                    break;
                case 'arrow':
                    insertAtCursor('â†’');
                    break;
                case 'slash':
                    insertAtCursor('/');
                    break;
            }
        }

        // ğŸ”¥ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ø®ØªØµØ§Ø±
        function insertShortcut(shortcut) {
            if (state.shortcuts[shortcut]) {
                insertAtCursor(state.shortcuts[shortcut]);
                showToast(`ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬: ${shortcut}`);
            }
        }

        // ğŸ”¥ Ø¥Ø¯Ø±Ø§Ø¬ Ø­ÙˆÙ„ Ø§Ù„Ù†Øµ
        function insertAround(left, right) {
            const textInput = document.getElementById('textInput');
            const start = textInput.selectionStart;
            const end = textInput.selectionEnd;
            const selected = textInput.value.slice(start, end);
            
            textInput.value = textInput.value.slice(0, start) + left + selected + right + textInput.value.slice(end);
            
            if (selected.length === 0) {
                textInput.selectionStart = start + 1;
                textInput.selectionEnd = start + 1;
            } else {
                textInput.selectionEnd = end + 2;
            }
        }

        // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± ÙƒÙ„Ù…Ø© (Ø£Ø®Ù Ù…Ù† Ø§Ù„Ø¨Ø­Ø« ÙƒÙ„ Ù…Ø±Ø©)
        function updateLastWord() {
            const text = state.text;
            const cursorPos = document.getElementById('textInput').selectionStart;
            
            const lastSpace = text.lastIndexOf(' ', cursorPos - 1);
            const lastNewline = text.lastIndexOf('\n', cursorPos - 1);
            const start = Math.max(lastSpace, lastNewline) + 1;
            
            state.lastWord = text.slice(start, cursorPos).trim();
        }

        // ğŸ”¥ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª
        function checkForShortcuts() {
            if (state.lastWord && state.shortcuts[state.lastWord]) {
                const textInput = document.getElementById('textInput');
                const cursorPos = textInput.selectionStart;
                const text = textInput.value;
                
                const lastSpace = text.lastIndexOf(' ', cursorPos - 1);
                const lastNewline = text.lastIndexOf('\n', cursorPos - 1);
                const start = Math.max(lastSpace, lastNewline) + 1;
                
                const replacement = state.shortcuts[state.lastWord];
                textInput.value = text.slice(0, start) + replacement + text.slice(cursorPos);
                textInput.selectionStart = start + replacement.length;
                textInput.selectionEnd = start + replacement.length;
                
                showToast(`Ø§Ø®ØªØµØ§Ø±: ${state.lastWord} â†’ ${replacement.slice(0, 20)}...`);
                state.lastWord = '';
            }
        }

        // ğŸ”¥ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…Ø¹ Debounce)
        function autoSave() {
            clearTimeout(state.saveTimer);
            state.saveTimer = setTimeout(() => {
                try {
                    localStorage.setItem('fuhaima_text', state.text);
                    localStorage.setItem('fuhaima_clipboard', JSON.stringify(state.clipboardData));
                } catch (e) {
                    console.warn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', e);
                }
            }, 1000); // Ø­ÙØ¸ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·
        }

        // ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        function loadInitialState() {
            try {
                const savedText = localStorage.getItem('fuhaima_text');
                if (savedText) {
                    document.getElementById('textInput').value = savedText;
                    state.text = savedText;
                }
                
                const savedClipboard = localStorage.getItem('fuhaima_clipboard');
                if (savedClipboard) {
                    state.clipboardData = JSON.parse(savedClipboard);
                }
            } catch (e) {
                console.warn('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', e);
            }
        }

        // ğŸ”¥ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙˆØ³Øª (Ø¨Ø¯Ù„ alert)
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // ğŸ”¥ ØªØ¨Ø¯ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù…ÙŠÙ‚Ø©
        function toggleDeepMode() {
            state.isDeepMode = !state.isDeepMode;
            document.body.classList.toggle('deep-writing', state.isDeepMode);
            document.getElementById('deepModeBtn').textContent = 
                state.isDeepMode ? 'ğŸ“– Ø¹Ø§Ø¯ÙŠ' : 'ğŸ•³ï¸ Ø¹Ù…ÙŠÙ‚';
        }

        // ğŸ”¥ ÙØªØ­ Ø§Ù„Ø­Ø§ÙØ¸Ø© (Lazy Load)
        function openClipboard() {
            const overlay = document.getElementById('clipboardOverlay');
            overlay.classList.add('show');
            
            // ğŸ”¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ ÙÙ‚Ø·
            if (state.clipboard.length === 0) {
                renderClipboard();
            }
            
            // Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
            setTimeout(() => {
                document.getElementById('clipboardSearch').focus();
            }, 100);
        }

        // ğŸ”¥ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        function closeClipboard() {
            document.getElementById('clipboardOverlay').classList.remove('show');
            document.getElementById('textInput').focus();
        }

        // ğŸ”¥ Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        function searchClipboard() {
            const query = document.getElementById('clipboardSearch').value.toLowerCase();
            renderClipboard(query);
        }

        // ğŸ”¥ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§ÙØ¸Ø© (Ø¨ØªØµÙÙŠØ©)
        function renderClipboard(filter = '') {
            const container = document.getElementById('clipboardItems');
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
            let items = state.clipboardData;
            
            if (filter) {
                items = items.filter(item => 
                    item.text.toLowerCase().includes(filter)
                );
            }
            
            if (items.length === 0) {
                container.innerHTML = '<div class="clipboard-item">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</div>';
                return;
            }
            
            container.innerHTML = items.map((item, index) => `
                <div class="clipboard-item" data-index="${index}">
                    <span style="font-size: 12px; color: var(--text-dim);">${index + 1}</span>
                    <div style="flex: 1; margin: 0 10px; overflow: hidden; text-overflow: ellipsis;">
                        ${item.text.length > 50 ? item.text.slice(0, 50) + '...' : item.text}
                    </div>
                    <button class="quick-btn" style="padding: 4px 8px; font-size: 12px;" data-paste="${index}">Ù„ØµÙ‚</button>
                </div>
            `).join('');
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù„ØµÙ‚
            container.querySelectorAll('[data-paste]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = parseInt(btn.dataset.paste);
                    insertAtCursor(items[index].text);
                    closeClipboard();
                });
            });
        }

        // ğŸ”¥ Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        function addToClipboard(text) {
            if (!text.trim()) return;
            
            // ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª
            if (state.clipboardData[0]?.text === text) return;
            
            state.clipboardData.unshift({
                text: text,
                time: new Date().toLocaleTimeString()
            });
            
            // Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø¢Ø®Ø± 30 Ø¹Ù†ØµØ± ÙÙ‚Ø·
            if (state.clipboardData.length > 30) {
                state.clipboardData = state.clipboardData.slice(0, 30);
            }
            
            autoSave();
        }

        // ğŸ”¥ Ù…Ù†Ø¹ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        document.getElementById('clipboardOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('clipboardOverlay')) {
                closeClipboard();
            }
        });
    </script>
</body>
</html>